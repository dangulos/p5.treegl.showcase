<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="p5.treegl # High-level space transformations WEBGL p5.js library which eases shader development.
Shaders Handling Macros Basic matrices Matrix queries Space transformations Heads Up Display Frustum queries Utilities Drawing stuff Installation Hacking Observe that all matrix operations in treegl are immutable, e.g., invMatrix:
let matrix = new p5.Matrix(); // invMatrix doesn't modify its matrix param, it gives a new value let iMatrix = invMatrix(matrix); // iMatrix !== matrix Note that the functions in the shaders and basic matrices sections are available only to p5; those of the matrix queries, space transformations, Heads Up Display, utilities and drawing stuff sections are available to p5, and p5."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="p5.treegl # High-level space transformations WEBGL p5.js library which eases shader development.
Shaders Handling Macros Basic matrices Matrix queries Space transformations Heads Up Display Frustum queries Utilities Drawing stuff Installation Hacking Observe that all matrix operations in treegl are immutable, e.g., invMatrix:
let matrix = new p5.Matrix(); // invMatrix doesn't modify its matrix param, it gives a new value let iMatrix = invMatrix(matrix); // iMatrix !== matrix Note that the functions in the shaders and basic matrices sections are available only to p5; those of the matrix queries, space transformations, Heads Up Display, utilities and drawing stuff sections are available to p5, and p5."><meta property="og:type" content="article"><meta property="og:url" content="https://dangulos.github.io/p5.treegl.showcase/libs/p5.treegl/README/"><meta property="article:section" content="libs"><title>Readme | P5.treegl Drawing Stuff</title><link rel=manifest href=/p5.treegl.showcase/manifest.json><link rel=icon href=/p5.treegl.showcase/favicon.png type=image/x-icon><link rel=stylesheet href=/p5.treegl.showcase/book.min.ab46de3e725a6415339a37bba23a0067534a37289b063c9f8d011515a63097a8.css integrity="sha256-q0bePnJaZBUzmje7ojoAZ1NKNyibBjyfjQEVFaYwl6g=" crossorigin=anonymous><script defer src=/p5.treegl.showcase/flexsearch.min.js></script>
<script defer src=/p5.treegl.showcase/en.search.min.22f27e248e927bd2a978c210cf90a34a11be8dce588cc1c3894974945f992130.js integrity="sha256-IvJ+JI6Se9KpeMIQz5CjShG+jc5YjMHDiUl0lF+ZITA=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/p5.treegl.showcase/><span>P5.treegl Drawing Stuff</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><input type=checkbox id=section-4f64e1ecb245dc4a145fefe6f0f6c7ac class=toggle>
<label for=section-4f64e1ecb245dc4a145fefe6f0f6c7ac class="flex justify-between"><a role=button>Componentes</a></label><ul><li><a href=/p5.treegl.showcase/docs/Componentes/Arrow/>Arrow</a></li><li><a href=/p5.treegl.showcase/docs/Componentes/Axes/>Axes</a></li><li><a href=/p5.treegl.showcase/docs/Componentes/Bagel/>Bagel</a></li><li><a href=/p5.treegl.showcase/docs/Componentes/Bullseye/>Bullseye</a></li><li><a href=/p5.treegl.showcase/docs/Componentes/Grid/>Grid</a></li><li><a href=/p5.treegl.showcase/docs/Componentes/Mobius_Strip/>Mobius Strip</a></li><li><a href=/p5.treegl.showcase/docs/Componentes/Pipe/>Pipe</a></li><li><a href=/p5.treegl.showcase/docs/Componentes/viewFrustum/>View Frustum</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/p5.treegl.showcase/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Readme</strong>
<label for=toc-control><img src=/p5.treegl.showcase/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#p5treegl>p5.treegl</a></li><li><a href=#shaders>Shaders</a><ul><li><a href=#handling>Handling</a></li><li><a href=#macros>Macros</a></li></ul></li><li><a href=#basic-matrices>Basic matrices</a></li><li><a href=#matrix-queries>Matrix queries</a></li><li><a href=#space-transformations>Space transformations</a></li><li><a href=#heads-up-display>Heads Up Display</a></li><li><a href=#frustum-queries>Frustum queries</a></li><li><a href=#utilities>Utilities</a></li><li><a href=#drawing-stuff>Drawing stuff</a></li><li><a href=#installation>Installation</a></li><li><a href=#vs-codehttpscodevisualstudiocom--vs-codiumhttpsvscodiumcom--gitpodhttpswwwgitpodio-hacking-instructions><a href=https://code.visualstudio.com/>vs-code</a> & <a href=https://vscodium.com/>vs-codium</a> & <a href=https://www.gitpod.io/>gitpod</a> hacking instructions</a><ul><li><a href=#contributors->Contributors ✨</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=p5treegl>p5.treegl
<a class=anchor href=#p5treegl>#</a></h1><p><a href=#contributors-><img src="https://img.shields.io/badge/all_contributors-2-orange.svg?style=flat-square" alt="All Contributors"></a></p><p>High-level space transformations <a href=https://p5js.org/reference/#/p5/WEBGL>WEBGL</a> <a href=https://p5js.org/>p5.js</a> library which eases shader development.</p><ul><li><a href=#shaders>Shaders</a><ul><li><a href=#handling>Handling</a></li><li><a href=#macros>Macros</a></li></ul></li><li><a href=#basic-matrices>Basic matrices</a></li><li><a href=#matrix-queries>Matrix queries</a></li><li><a href=#space-transformations>Space transformations</a></li><li><a href=#heads-up-display>Heads Up Display</a></li><li><a href=#frustum-queries>Frustum queries</a></li><li><a href=#utilities>Utilities</a></li><li><a href=#drawing-stuff>Drawing stuff</a></li><li><a href=#installation>Installation</a></li><li><a href=#vs-code--vs-codium--gitpod-hacking-instructions>Hacking</a></li></ul><p>Observe that <em>all</em> matrix operations in <code>treegl</code> are <a href=https://developer.mozilla.org/en-US/docs/Glossary/Primitive>immutable</a>, e.g., <a href=#basic-matrices>invMatrix</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>matrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>();
</span></span><span style=display:flex><span><span style=color:#75715e>// invMatrix doesn&#39;t modify its matrix param, it gives a new value
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>iMatrix</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>invMatrix</span>(<span style=color:#a6e22e>matrix</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// iMatrix !== matrix
</span></span></span></code></pre></div><p>Note that the functions in the <a href=#shaders>shaders</a> and <a href=#basic-matrices>basic matrices</a> sections are available only to <code>p5</code>; those of the <a href=#matrix-queries>matrix queries</a>, <a href=#space-transformations>space transformations</a>, <a href=#heads-up-display>Heads Up Display</a>, <a href=#utilities>utilities</a> and <a href=#drawing-stuff>drawing stuff</a> sections are available to <code>p5</code>, and <a href=https://p5js.org/reference/#/p5.Renderer>p5.RendererGL</a> instances; and, those of the <a href=#frustum-queries>frustum queries</a> section are available to <code>p5</code> and <a href=https://p5js.org/reference/#/p5.Renderer>p5.RendererGL</a>, and <a href=https://github.com/processing/p5.js/blob/main/src/webgl/p5.Matrix.js>p5.Matrix</a> instances.</p><h1 id=shaders>Shaders
<a class=anchor href=#shaders>#</a></h1><h2 id=handling>Handling
<a class=anchor href=#handling>#</a></h2><ol><li><code>parseVertexShader([{[precision = Tree.mediump], [matrices = Tree.pmvMatrix], [varyings = Tree.color4 | Tree.texcoords2]}])</code>: parses <code>precision</code>, <code>matrices</code> and <code>varyings</code> params into a vertex shader which is returned as a string. For example:
calling <code>parseVertexShader()</code> without any arguments will return (and also log onto the console) the following string:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-glsl data-lang=glsl><span style=display:flex><span><span style=color:#66d9ef>precision</span> <span style=color:#66d9ef>mediump</span> <span style=color:#66d9ef>float</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>attribute</span> <span style=color:#66d9ef>vec3</span> aPosition;
</span></span><span style=display:flex><span><span style=color:#66d9ef>attribute</span> <span style=color:#66d9ef>vec4</span> aVertexColor;
</span></span><span style=display:flex><span><span style=color:#66d9ef>attribute</span> <span style=color:#66d9ef>vec2</span> aTexCoord;
</span></span><span style=display:flex><span><span style=color:#66d9ef>uniform</span> mat4 uModelViewProjectionMatrix;
</span></span><span style=display:flex><span><span style=color:#66d9ef>varying</span> <span style=color:#66d9ef>vec4</span> color4;
</span></span><span style=display:flex><span><span style=color:#66d9ef>varying</span> <span style=color:#66d9ef>vec2</span> texcoords2;
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> main() {
</span></span><span style=display:flex><span>  color4 <span style=color:#f92672>=</span> aVertexColor;
</span></span><span style=display:flex><span>  texcoords2 <span style=color:#f92672>=</span> aTexCoord;
</span></span><span style=display:flex><span>  gl_Position <span style=color:#f92672>=</span> uModelViewProjectionMatrix <span style=color:#f92672>*</span> <span style=color:#66d9ef>vec4</span>(aPosition, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><code>readShader(fragFilename, [{[precision = Tree.mediump], [matrices = Tree.pmvMatrix], [varyings = Tree.color4 | Tree.texcoords2]}])</code>: (similar to <a href=https://p5js.org/reference/#/p5/loadShader>loadShader</a>) loads a fragment shader from (string) file path and returns a <a href=https://p5js.org/reference/#/p5.Shader>p5.Shader</a>. Note that the behind the scenes vertex shader is automatically generated (and log onto the console) from a call to: <code>parseVertexShader({precision: precision, matrices: matrices, varyings: varyings})</code>.</li><li><code>makeShader(fragSrc, [{[precision = Tree.mediump], [matrices = Tree.pmvMatrix], [varyings = Tree.color4 | Tree.texcoords2]}])</code>: (similar to <a href=https://p5js.org/reference/#/p5/createShader>createShader</a>) creates a fragment shader from (string) source and returns a <a href=https://p5js.org/reference/#/p5.Shader>p5.Shader</a>. Note that the behind the scenes vertex shader is automatically generated (and log onto the console) from a call to: <code>parseVertexShader({precision: precision, matrices: matrices, varyings: varyings})</code>.</li></ol><p><strong>Observations</strong></p><ol><li>The <code>precision</code> param defines the vertex shader <a href=https://www.khronos.org/opengl/wiki/Type_Qualifier_%28GLSL%29#Precision_qualifiers>float precision</a>. It may be either <code>Tree.lowp</code>, <code>Tree.mediump</code> or <code>Tree.highp</code>.</li><li>The <code>matrices</code> param defines the <a href=https://visualcomputing.github.io/docs/shaders/programming_paradigm/>vertex shader uniform matrices</a> from <code>Tree.pmvMatrix</code>, <code>Tree.pMatrix</code>, <code>Tree.mvMatrix</code>, <code>Tree.nMatrix</code> or <code>Tree.NONE</code> (i.e., to not emit any matrix) bits, e.g., calling <code>parseVertexShader({ matrices: Tree.pMatrix | Tree.mvMatrix })</code> would return (and also log onto the console) something like:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-glsl data-lang=glsl><span style=display:flex><span><span style=color:#75715e>// float precision</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// attributes ...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>uniform</span> mat4 uProjectionMatrix;
</span></span><span style=display:flex><span><span style=color:#66d9ef>uniform</span> mat4 uModelViewMatrix;
</span></span><span style=display:flex><span><span style=color:#75715e>// varyings ...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> main() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// processed varyings</span>
</span></span><span style=display:flex><span>  gl_Position <span style=color:#f92672>=</span> uProjectionMatrix <span style=color:#f92672>*</span> uModelViewMatrix <span style=color:#f92672>*</span> <span style=color:#66d9ef>vec4</span>(aPosition, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div>Matrix uniform variables are automatically emit by the <a href=https://p5js.org/reference/>p5 api</a>, such as when issuing a <a href=https://p5js.org/reference/#/p5/camera>camera</a> or a <a href=https://p5js.org/reference/#/p5/translate>translate</a> command. Keep in mind the matrix uniform variables naming convention as defined <a href=https://github.com/processing/p5.js/blob/main/contributor_docs/webgl_mode_architecture.md#shader-parameters>here</a>, since you should also follow it within your fragment shader.</li><li>The <code>varyings</code> param defines the <a href=https://visualcomputing.github.io/docs/shaders/programming_paradigm/>vertex shader attributes</a> to be interpolated to the fragment shader from <code>Tree.color4</code>, <code>Tree.texcoords2</code> (<a href=https://visualcomputing.github.io/docs/shaders/texturing/>texture coordinates</a>), <code>Tree.normal3</code>, <code>Tree.position2</code>, <code>Tree.position3</code> or <code>Tree.NONE</code> (i.e., to not emit any varying) bits, e.g., calling <code>parseVertexShader({ varyings = Tree.color4 | Tree.texcoords2 })</code> would return (and also log onto the console) something like:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-glsl data-lang=glsl><span style=display:flex><span><span style=color:#75715e>// color4 and texcoords2 names match those of</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Tree.color4 and Tree.texcoords2, resp.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// float precision</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>attribute</span> <span style=color:#66d9ef>vec4</span> aVertexColor;
</span></span><span style=display:flex><span><span style=color:#66d9ef>attribute</span> <span style=color:#66d9ef>vec2</span> aTexCoord;
</span></span><span style=display:flex><span><span style=color:#75715e>// matrix uniforms...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>varying</span> <span style=color:#66d9ef>vec4</span> color4;
</span></span><span style=display:flex><span><span style=color:#66d9ef>varying</span> <span style=color:#66d9ef>vec2</span> texcoords2;
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> main() {
</span></span><span style=display:flex><span>  color4 <span style=color:#f92672>=</span> aVertexColor;
</span></span><span style=display:flex><span>  texcoords2 <span style=color:#f92672>=</span> aTexCoord;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// gl_Position</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div>which produces the default case output. Keep in mind the <code>varying</code> naming convention used within the vertex shader, since <em>it should</em> be the same you employ within your custom fragment shader.</li></ol><p>Feel free to test the <code>parseVertexShader</code> function described above, trying out different <code>precision</code>, <code>matrices</code> and <code>varyings</code> params and see what output best suit your particular needs.</p><h2 id=macros>Macros
<a class=anchor href=#macros>#</a></h2><p>Send common <code>uniform vec2</code> variables, such as: image offset, pointer position, and screen resolution, to <code>shader</code>. Note that the variable names are customizable.</p><ol><li><code>emitTexOffset(shader, image, [uniform = 'u_texoffset'])</code> as: <code>[1 / image.width, 1 / image.height]</code>.</li><li><code>emitMousePosition(shader, [uniform = 'u_mouse'])</code> as: <code>[mouseX * pixelDensity(), (height - mouseY) * pixelDensity()]</code>.</li><li><code>emitPointerPosition(shader, pointerX, pointerY, [uniform = 'u_pointer'])</code> as: <code>[pointerX * pixelDensity(), (height - pointerY) * pixelDensity()]</code>. Available to both, the <code>p5</code> object and <a href=https://p5js.org/reference/#/p5.Renderer>p5.RendererGL</a> instances.</li><li><code>emitResolution(shader, [uniform = 'u_resolution'])</code> as: <code>[width * pixelDensity(), height * pixelDensity()]</code>. Available to both, the <code>p5</code> object and <a href=https://p5js.org/reference/#/p5.Renderer>p5.RendererGL</a> instances.</li></ol><h1 id=basic-matrices>Basic matrices
<a class=anchor href=#basic-matrices>#</a></h1><ol><li><code>iMatrix()</code>: Returns the identity matrix.</li><li><code>tMatrix(matrix)</code>: Returns the tranpose of <code>matrix</code>.</li><li><code>invMatrix(matrix)</code>: Returns the inverse of <code>matrix</code>.</li><li><code>axbMatrix(a, b)</code>: Returns the product of the <code>a</code> and <code>b</code> matrices.</li></ol><p><strong>Observation:</strong> All returned matrices are instances of <a href=https://github.com/processing/p5.js/blob/main/src/webgl/p5.Matrix.js>p5.Matrix</a>.</p><h1 id=matrix-queries>Matrix queries
<a class=anchor href=#matrix-queries>#</a></h1><ol><li><code>pMatrix()</code>: Returns the current projection matrix.</li><li><code>mvMatrix([{[vMatrix], [mMatrix]}])</code>: Returns the modelview matrix.</li><li><code>mMatrix([{[eMatrix], [mvMatrix]}])</code>: Returns the model matrix.</li><li><code>eMatrix()</code>: Returns the current eye matrix (the inverse of <code>vMatrix()</code>). In addition to <code>p5</code> and <a href=https://p5js.org/reference/#/p5.Renderer>p5.RendererGL</a> instances, this method is also available to <a href=https://p5js.org/reference/#/p5.Camera>p5.Camera</a> objects.</li><li><code>vMatrix()</code>: Returns the view matrix (the inverse of <code>eMatrix()</code>). In addition to <code>p5</code> and <a href=https://p5js.org/reference/#/p5.Renderer>p5.RendererGL</a> instances, this method is also available to <a href=https://p5js.org/reference/#/p5.Camera>p5.Camera</a> objects.</li><li><code>pvMatrix([{[pMatrix], [vMatrix]}])</code>: Returns the projection times view matrix.</li><li><code>pvInvMatrix([{[pMatrix], [vMatrix], [pvMatrix]}])</code>: Returns the <code>pvMatrix</code> inverse.</li><li><code>lMatrix([{[from = iMatrix()], [to = this.eMatrix()]}])</code>: Returns the 4x4 matrix that transforms locations (points) from matrix <code>from</code> to matrix <code>to</code>.</li><li><code>dMatrix([{[from = iMatrix()], [to = this.eMatrix()]}])</code>: Returns the 3x3 matrix (only <a href=https://visualcomputing.github.io/docs/transformations/affine/#3d-rotation>rotational part</a> is needed) that transforms displacements (vectors) from matrix <code>from</code> to matrix <code>to</code>. The <code>nMatrix</code> below is a special case of this one.</li><li><code>nMatrix([{[vMatrix], [mMatrix], [mvMatrix]}])</code>: Returns the <a href=http://www.lighthouse3d.com/tutorials/glsl-12-tutorial/the-normal-matrix/>normal matrix</a>.</li></ol><p><strong>Observations</strong></p><ol><li>All returned matrices are instances of <a href=https://github.com/processing/p5.js/blob/main/src/webgl/p5.Matrix.js>p5.Matrix</a>.</li><li>The <code>pMatrix</code>, <code>vMatrix</code>, <code>pvMatrix</code>, <code>eMatrix</code>, <code>mMatrix</code> and <code>mvMatrix</code> default values are those <a href=#matrix-queries>defined by the renderer</a> at the moment the query is issued.</li></ol><h1 id=space-transformations>Space transformations
<a class=anchor href=#space-transformations>#</a></h1><ol><li><code>treeLocation(vector = Tree.ORIGIN, [{[from = Tree.EYE], [to = Tree.WORLD], [pMatrix], [vMatrix], [eMatrix], [pvMatrix], [pvInvMatrix]}])</code>: transforms locations (points) from matrix <code>from</code> to matrix <code>to</code>.</li><li><code>treeDisplacement(vector = Tree._k, [{[from = Tree.EYE], [to = Tree.WORLD], [vMatrix], [eMatrix], [pMatrix]}])</code>: transforms displacements (vectors) from matrix <code>from</code> to matrix <code>to</code>.</li></ol><p>Pass matrix params when you <em>cached</em> those matrices (see the <a href=#matrix-queries>previous section</a>), either to speedup computations, e.g.,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pvInv</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>functon</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// cache pvInv at the beginning of the rendering loop
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// note that this matrix rarely change within the iteration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>pvInv</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pvInvMatrix</span>();
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// speedup treeLocation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>treeLocation</span>(<span style=color:#a6e22e>vector</span>, { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span>, <span style=color:#a6e22e>pvInvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvInv</span> });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>treeLocation</span>(<span style=color:#a6e22e>vector</span>, { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span>, <span style=color:#a6e22e>pvInvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvInv</span> });
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ... many more treeLocation calls....
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// ... all the above treeLocation calls used the (only computed once) cached pvInv matrix
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>or to transform points (and vectors) between local spaces, e.g.,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>model</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// save model matrix as it is set just before drawing your model
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>model</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mMatrix</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>drawModel</span>();
</span></span><span style=display:flex><span>  <span style=color:#75715e>// continue drawing your tree...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// let&#39;s draw a bulls eye at the model origin screen projection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>screenProjection</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>treeLocation</span>(<span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>ORIGIN</span>, { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>model</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span> });
</span></span><span style=display:flex><span>  <span style=color:#75715e>// which is the same as:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// let screenProjection = treeLocation(createVector(0, 0, 0), { from: model, to: Tree.SCREEN });
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// or,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// let screenProjection = treeLocation([0, 0, 0], { from: model, to: Tree.SCREEN });
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// or, more simply:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// let screenProjection = treeLocation({ from: model, to: Tree.SCREEN });
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>bullsEye</span>({ <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>screenProjection</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>screenProjection</span>.<span style=color:#a6e22e>y</span> });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Observations</strong></p><ol><li>Returned transformed vectors are instances of <a href=https://p5js.org/reference/#/p5.Vector>p5.Vector</a>.</li><li><code>from</code> and <code>to</code> may also be specified as either: <code>Tree.WORLD</code>, <code>Tree.EYE</code>, <code>Tree.SCREEN</code> or <code>Tree.NDC</code>.</li><li>When no matrix params (<code>eMatrix</code>, <code>pMatrix</code>,&mldr;) are passed the renderer <a href=#matrix-queries>current values</a> are used instead.</li><li>The default <code>treeLocation</code> call (i.e., <code>treeLocation(Tree.ORIGIN, {from: Tree.EYE, to: Tree.WORLD)</code>) returns the <a href=https://learnopengl.com/Getting-started/Camera>camera world position</a>.</li><li>Note that the default <code>treeDisplacement</code> call (i.e., <code>treeDisplacement(Tree._k, {from: Tree.EYE, to: Tree.WORLD)</code>) returns the normalized <a href=https://learnopengl.com/Getting-started/Camera>camera viewing direction</a>.</li><li>Other useful vector constants, different than <code>Tree.ORIGIN</code> (i.e., <code>[0, 0, 0]</code>) and <code>Tree._k</code> (i.e., <code>[0, 0, -1]</code>), are: <code>Tree.i</code> (i.e., <code>[1, 0, 0]</code>), <code>Tree.j</code> (i.e., <code>[0, 1, 0]</code>), <code>Tree.k</code> (i.e., <code>[0, 0, 1]</code>), <code>Tree._i</code> (i.e., <code>[-1, 0, 0]</code>) and <code>Tree._j</code> (i.e., <code>[0, -1, 0]</code>).</li></ol><h1 id=heads-up-display>Heads Up Display
<a class=anchor href=#heads-up-display>#</a></h1><ol><li><code>beginHUD()</code>: Begins <a href=https://en.wikipedia.org/wiki/Head-up_display>Heads Up Display</a>, so that geometry specified between <code>beginHUD()</code> and <code>endHUD()</code> is defined in window space. Should always be used in conjunction with <code>endHUD</code>.</li><li><code>endHUD()</code>: Ends <a href=https://en.wikipedia.org/wiki/Head-up_display>Heads Up Display</a>, so that geometry specified between <code>beginHUD()</code> and <code>endHUD()</code> is defined in window space. Should always be used in conjunction with <code>beginHUD</code>.</li></ol><h1 id=frustum-queries>Frustum queries
<a class=anchor href=#frustum-queries>#</a></h1><ol><li><code>lPlane()</code>: Returns the left clipping plane.</li><li><code>rPlane()</code>: Returns the right clipping plane.</li><li><code>bPlane()</code>: Returns the bottom clipping plane.</li><li><code>tPlane()</code>: Returns the top clipping plane.</li><li><code>nPlane()</code>: Returns the near clipping plane.</li><li><code>fPlane()</code>: Returns the far clipping plane.</li><li><code>fov()</code>: Returns the vertical field-of-view (fov) in radians.</li><li><code>hfov()</code>: Returns the horizontal field-of-view (hfov) in radians.</li></ol><h1 id=utilities>Utilities
<a class=anchor href=#utilities>#</a></h1><ol><li><code>pixelRatio(location)</code>: Returns the world to pixel ratio units at given world location, i.e., a line of <code>n * pixelRatio(location)</code> world units will be projected with a length of <code>n</code> pixels on screen.</li><li><code>mousePicking({ [mMatrix], [x = this.width / 2], [y = this.height / 2], [size = 50], [shape = Tree.CIRCLE], [eMatrix], [pMatrix], [vMatrix], [pvMatrix] })</code>: same as <code>return this.pointerPicking(this.mouseX, this.mouseY, { mMatrix: mMatrix, x: x, y: y, size: size, shape: shape, eMatrix: eMatrix, pMatrix: pMatrix, vMatrix: vMatrix, pvMatrix: pvMatrix })</code> (see below).</li><li><code>pointerPicking(pointerX, pointerY, { [mMatrix], [x = this.width / 2], [y = this.height / 2], [size = 50], [shape = Tree.CIRCLE], [eMatrix], [pMatrix], [vMatrix], [pvMatrix] })</code>: Returns <code>true</code> if <code>pointerX</code>, <code>pointerY</code> lies within the screen space circle centered at (<code>x</code>, <code>y</code>) and having <code>size</code> diameter. Use <code>mMatrix</code> to compute (<code>x</code>, <code>y</code>) as the screen space projection of the model space origin and having <code>size</code> as its bounding sphere diameter. Use <code>Tree.SQUARE</code> to use a squared shape instead of a circled one.</li><li><code>visibility</code>: Returns object visibility, either as <code>Tree.VISIBLE</code>, <code>Tree.INVISIBLE</code>, or <code>Tree.SEMIVISIBLE</code>. Object may be either a <em>point</em>: <code>visibility({ center, [bounds = this.bounds()]})</code>, a <em>ball</em>: <code>visibility({ center, radius, [bounds = this.bounds()]})</code> or an <em>axis-aligned box</em>: <code>visibility({ corner1, corner2, [bounds = this.bounds()]})</code>.</li><li><code>bounds()</code>: Returns the <a href=http://www.songho.ca/math/plane/plane.html>general form</a> of the current frustum six plane equations, i.e., <em>ax + by + cz + d = 0</em>, formatted as an object literal having keys: <code>Tree.LEFT</code>, <code>Tree.RIGHT</code>, <code>Tree.BOTTOM</code>, <code>Tree.TOP</code>, <code>Tree.NEAR</code> and <code>Tree.FAR</code>, e.g., access the near plane coefficients as:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>bounds</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>bounds</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>near</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>bounds</span>[<span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NEAR</span>];<span style=color:#75715e>// near.a, near.b, near.c and near.d
</span></span></span></code></pre></div></li></ol><h1 id=drawing-stuff>Drawing stuff
<a class=anchor href=#drawing-stuff>#</a></h1><ol><li><code>axes([{ [size = 100], [bits = Tree.LABELS | Tree.X | Tree.Y | Tree.Z] }])</code>: Draws axes with given <code>size</code> in world units, and bitwise mask that may be composed of <code>Tree.X</code>, <code>Tree._X</code>, <code>Tree.Y</code>, <code>Tree._Y</code>, <code>Tree.Z</code>, <code>Tree._Z</code> and <code>Tree.LABELS</code> <code>bits</code>.</li><li><code>grid([{ [size = 100], [subdivisions = 10], [style = Tree.DOTS] }])</code>: Draws grid with given <code>size</code> in world units, <code>subdivisions</code> and <code>dotted</code> (<code>Tree.DOTS</code>) or solid (<code>Tree.SOLID</code>) lines.</li><li><code>cross([{ [mMatrix], [x = this.width / 2], [y = this.height / 2], [size = 50], [eMatrix], [pMatrix], [vMatrix], [pvMatrix] }])</code>: Draws a cross at <code>x</code>, <code>y</code> screen coordinates with given <code>size</code> in pixels. Use <code>mMatrix</code> to compute (<code>x</code>, <code>y</code>) as the screen projection of the model space origin.</li><li><code>bullsEye([{ [mMatrix], [x = this.width / 2], [y = this.height / 2], [size = 50], [shape = Tree.CIRCLE], [eMatrix], [pMatrix], [vMatrix], [pvMatrix] }])</code>: Draws a circled bullseye (use <code>Tree.SQUARE</code> to draw it as a square) at <code>x</code>, <code>y</code> screen coordinates with given <code>size</code> in pixels. Use <code>mMatrix</code> to compute (<code>x</code>, <code>y</code>) as the screen projection of the model space origin.</li><li><code>viewFrustum([{ [fbo = _renderer], [bits = Tree.NEAR | Tree.FAR], [viewer = () => this.axes({ size: 50, bits: Tree.X | Tree._X | Tree.Y | Tree._Y | Tree.Z | Tree._Z })] }])</code>: Draws frame buffer object (<code>fbo</code>) view frustum representation according to view-frustum bitwise mask <code>bits</code> which may be composed of <code>Tree.NEAR</code>, <code>Tree.FAR</code> and <code>Tree.BODY</code> <code>bits</code>, and <code>viewer</code> callback visual representation.</li></ol><h1 id=installation>Installation
<a class=anchor href=#installation>#</a></h1><p>Link the <code>p5.treegl.js</code> library into your HTML file, after you have linked in <a href=https://p5js.org/libraries/>p5.js</a>. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!doctype html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;p5.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;p5.sound.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5.treegl.js</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sketch.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><p>to include its minified version use:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5.treegl.min.js</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><p>instead.</p><h1 id=vs-codehttpscodevisualstudiocom--vs-codiumhttpsvscodiumcom--gitpodhttpswwwgitpodio-hacking-instructions><a href=https://code.visualstudio.com/>vs-code</a> & <a href=https://vscodium.com/>vs-codium</a> & <a href=https://www.gitpod.io/>gitpod</a> hacking instructions
<a class=anchor href=#vs-codehttpscodevisualstudiocom--vs-codiumhttpsvscodiumcom--gitpodhttpswwwgitpodio-hacking-instructions>#</a></h1><p>To run and hack the testing <a href=https://github.com/VisualComputing/p5.treegl/tree/main/examples>examples</a>:</p><ol><li>Clone the repo (<code>git clone https://github.com/VisualComputing/p5.treegl</code>) and open it with your favorite editor.</li><li>Install the <a href="https://marketplace.visualstudio.com/items?itemName=samplavigne.p5-vscode">p5-vscode extension</a>.</li><li>Head over <code>examples/*/index.html</code> and press your editor <code>Go Live</code> button.</li></ol><p>Don&rsquo;t forget to check these <a href=https://p5js.org/>p5.js</a> references:</p><ol><li><a href=https://github.com/processing/p5.js/blob/main/contributor_docs/creating_libraries.md>Library creation</a>.</li><li><a href=https://github.com/processing/p5.js/blob/main/src/core/README.md>Software architecture</a>.</li><li><a href=https://github.com/processing/p5.js/blob/main/contributor_docs/webgl_mode_architecture.md>Webgl mode</a>.</li></ol><h2 id=contributors->Contributors ✨
<a class=anchor href=#contributors->#</a></h2><p>Thanks goes to these wonderful people (<a href=https://allcontributors.org/docs/en/emoji-key>emoji key</a>):</p><table><tr><td align=center><a href=https://github.com/nakednous><img src="https://avatars.githubusercontent.com/u/645599?v=4?s=100" width=100px; alt><br><sub><b>Jean Pierre Charalambos</b></sub></a><br><a href=#ideas-nakednous title="Ideas, Planning, & Feedback">🤔</a> <a href=#design-nakednous title=Design>🎨</a> <a href=#talk-nakednous title=Talks>📢</a> <a href=#blog-nakednous title=Blogposts>📝</a> <a href=#example-nakednous title=Examples>💡</a> <a href=#tutorial-nakednous title=Tutorials>✅</a> <a href=#video-nakednous title=Videos>📹</a> <a href="https://github.com/VisualComputing/p5.treegl/commits?author=nakednous" title=Tests>⚠️</a> <a href="https://github.com/VisualComputing/p5.treegl/issues?q=author%3Anakednous" title="Bug reports">🐛</a> <a href="https://github.com/VisualComputing/p5.treegl/commits?author=nakednous" title=Code>💻</a></td><td align=center><a href=https://github.com/dangulos><img src="https://avatars.githubusercontent.com/u/38595886?v=4?s=100" width=100px; alt><br><sub><b>dangulos</b></sub></a><br><a href="https://github.com/VisualComputing/p5.treegl/commits?author=dangulos" title=Documentation>📖</a> <a href="https://github.com/VisualComputing/p5.treegl/commits?author=dangulos" title=Tests>⚠️</a> <a href="https://github.com/VisualComputing/p5.treegl/issues?q=author%3Adangulos" title="Bug reports">🐛</a> <a href="https://github.com/VisualComputing/p5.treegl/commits?author=dangulos" title=Code>💻</a></td></tr></table><p>This project follows the <a href=https://github.com/all-contributors/all-contributors>all-contributors</a> specification. Contributions of any kind welcome!</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#p5treegl>p5.treegl</a></li><li><a href=#shaders>Shaders</a><ul><li><a href=#handling>Handling</a></li><li><a href=#macros>Macros</a></li></ul></li><li><a href=#basic-matrices>Basic matrices</a></li><li><a href=#matrix-queries>Matrix queries</a></li><li><a href=#space-transformations>Space transformations</a></li><li><a href=#heads-up-display>Heads Up Display</a></li><li><a href=#frustum-queries>Frustum queries</a></li><li><a href=#utilities>Utilities</a></li><li><a href=#drawing-stuff>Drawing stuff</a></li><li><a href=#installation>Installation</a></li><li><a href=#vs-codehttpscodevisualstudiocom--vs-codiumhttpsvscodiumcom--gitpodhttpswwwgitpodio-hacking-instructions><a href=https://code.visualstudio.com/>vs-code</a> & <a href=https://vscodium.com/>vs-codium</a> & <a href=https://www.gitpod.io/>gitpod</a> hacking instructions</a><ul><li><a href=#contributors->Contributors ✨</a></li></ul></li></ul></nav></div></aside></main></body></html>